<!DOCTYPE html>
<html lang="id" data-theme="pastel">

<head>
    <meta charset="utf-8">
    <script src="theme-sync.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Kosakata Bahasa Jepang (N5/N4) â€” Latihan</title>
    <meta name="description"
        content="Daftar kosakata dasar bahasa Jepang N5 dan N4 berdasarkan level dan kategori. Lengkap dengan kana, romaji, arti, dan audio pelafalan." />
    <meta name="theme-color" content="#7a6cff">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;700&family=Noto+Serif+JP:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* Menggunakan style yang sama dari index.html untuk konsistensi */
        :root {
            --bg: #f8fbff;
            --panel: #ffffff;
            --soft: #f2f6ff;
            --ink: #132030;
            --muted: #76849c;
            --pri: #7a6cff;
            --sec: #16c6a1;
            --warn: #ff7b7b;
            --ok: #2fb875;
            --accent: #ffd166;
            --btn: #e9eefc;
            --btnText: #0b101a;
            --border: rgba(19, 32, 48, .10);
            --radius: 18px;
            --shadow: 0 6px 18px rgba(15, 23, 34, .08);
            --ring: 0 0 0 3px rgba(122, 108, 255, .28);
            --iconColor: var(--muted);
            --transition-duration: 0.2s;
        }

        [data-theme="hc"] {
            --bg: #0a0f1a;
            --panel: #0f1626;
            --soft: #0c1220;
            --ink: #e6efff;
            --muted: #9fb0cc;
            --pri: #8fa8ff;
            --sec: #3dd8b5;
            --warn: #ff8c8c;
            --ok: #7be0b3;
            --accent: #ffd98a;
            --btn: #18243a;
            --btnText: #e6efff;
            --border: rgba(230, 239, 255, .12);
            --ring: 0 0 0 3px rgba(143, 168, 255, .35);
            --okBg: #1a3a2e;
            --warnBg: #3a1a1a;
            --iconColor: var(--ink);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            max-width: 100%;
            overflow-x: hidden;
        }

        body {
            min-height: 100svh;
            margin: 0;
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            background:
                radial-gradient(900px 420px at -10% -20%, rgba(122, 108, 255, .10), transparent),
                radial-gradient(900px 420px at 110% -30%, rgba(22, 198, 161, .12), transparent),
                var(--bg);
            color: var(--ink);
            transition: background-color var(--transition-duration) ease-out, color var(--transition-duration) ease-out;
        }

        .wrap {
            /* Memastikan konten tidak terlalu lebar di layar besar */
            max-width: 960px;
            margin: auto;
            /* Memposisikan konten di tengah */
            padding: 16px;
            /* Menyesuaikan padding untuk area aman pada perangkat mobile (notch, dll) */
            padding-left: calc(16px + env(safe-area-inset-left));
            padding-right: calc(16px + env(safe-area-inset-right));
        }

        header {
            position: sticky;
            top: 0;
            z-index: 30;
            background: linear-gradient(180deg, rgba(255, 255, 255, .92), rgba(255, 255, 255, .72));
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border);
            padding-top: env(safe-area-inset-top);
            transition: background var(--transition-duration) ease-out, backdrop-filter var(--transition-duration) ease-out, border-bottom-color var(--transition-duration) ease-out;
        }

        [data-theme="hc"] header {
            background: linear-gradient(180deg, rgba(15, 22, 38, .86), rgba(15, 22, 38, .66))
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .logo {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--pri), var(--sec));
            box-shadow: var(--shadow);
            transition: box-shadow var(--transition-duration) ease-out, background var(--transition-duration) ease-out;
        }

        h1 {
            font-size: 20px;
            margin: 0
        }

        .small {
            font-size: 12px;
            color: var(--muted)
        }

        .card {
            background: var(--panel);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 16px;
            border: 1px solid var(--border);
            transition: background-color var(--transition-duration) ease-out, border-color var(--transition-duration) ease-out, box-shadow var(--transition-duration) ease-out;
        }

        .card h2 {
            font-size: 16px;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card h2 .icon {
            color: var(--iconColor);
            transition: color var(--transition-duration) ease-out;
        }

        .card h3.filter-label {
            font-size: 14px;
            margin: 12px 0 8px 0;
            color: var(--muted);
            font-weight: 500;
        }

        /* Gaya baru untuk label filter */
        .row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center
        }

        .btn {
            min-height: 52px;
            padding: 0 16px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all var(--transition-duration) ease-out;
            color: var(--ink);
            background: var(--btn);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:active {
            transform: translateY(1px)
        }

        .btn.primary {
            background: linear-gradient(135deg, var(--pri), var(--sec));
            color: white;
        }

        .btn.ghost {
            background: transparent;
            outline: 1px solid var(--border);
            color: var(--ink);
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: var(--ring);
            outline-offset: 3px;
        }

        .spacer {
            height: 16px
        }

        /* Sembunyikan nav/header lama kalau ada */
        .main-nav {
            display: none !important;
        }

        input[type="search"] {
            width: 100%;
            /* Memastikan input selalu memenuhi lebar container */
            padding: 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--soft);
            color: var(--ink);
            transition: border-color var(--transition-duration) ease-out, background-color var(--transition-duration) ease-out, box-shadow var(--transition-duration) ease-out;
        }

        input[type="search"]:focus {
            border-color: var(--pri);
            outline: none;
            box-shadow: var(--ring);
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            /* Memastikan chip-chip akan melipat ke baris baru jika tidak cukup ruang */
            gap: 8px;
        }

        .chip {
            padding: 8px 12px;
            border-radius: 999px;
            background: var(--soft);
            border: 1px solid var(--border);
            cursor: pointer;
            font-size: 14px;
            transition: all var(--transition-duration) ease-out;
            color: var(--ink);
        }

        .chip.active {
            background: linear-gradient(135deg, rgba(122, 108, 255, .18), rgba(22, 198, 161, .18));
            border-color: var(--pri);
        }

        /* Style khusus untuk Daftar Kosakata */
        .vocab-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .vocab-item {
            display: flex;
            justify-content: space-between;
            /* Memisahkan konten Jepang dan Indonesia */
            align-items: center;
            padding: 12px 8px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background-color var(--transition-duration) ease-out;
            position: relative;
        }

        .vocab-item:hover {
            background-color: var(--soft);
        }

        .vocab-item:last-child {
            border-bottom: none;
        }

        .vocab-jp {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 20px;
            flex-shrink: 0;
            /* Mencegah bagian Jepang menyusut terlalu banyak */
        }

        .vocab-jp .kanji {
            font-weight: 600;
        }

        .vocab-jp .kana {
            font-size: 14px;
            color: var(--muted);
            margin-left: 8px;
        }

        .vocab-id {
            text-align: right;
            flex-grow: 1;
            /* Memungkinkan bagian Indonesia mengisi ruang yang tersisa */
            min-width: 0;
            /* Penting untuk flexbox agar konten bisa memendek */
            white-space: normal;
            /* Mengizinkan teks untuk melipat (wrap) */
            word-break: break-word;
            /* Memecah kata panjang jika diperlukan */
        }

        .vocab-id .romaji {
            font-size: 12px;
            color: var(--muted);
            display: block;
        }

        .vocab-id .arti {
            font-size: 16px;
        }

        .vocab-item i {
            color: var(--muted);
            margin-left: 16px;
            font-size: 16px;
            flex-shrink: 0;
            /* Mencegah ikon menyusut */
        }

        /* === Sidebar === */
        .sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: 280px;
            height: 100%;
            background: var(--panel) !important;
            box-shadow: var(--shadow);
            z-index: 9999 !important;
            transition: left .3s ease-in-out;
            padding: 20px;
            padding-top: calc(20px + env(safe-area-inset-top));
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            border-right: 1px solid var(--border);
        }

        .sidebar.is-open {
            left: 0;
        }

        .sidebar .menu {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .sidebar .menu li a {
            display: flex;
            gap: .5rem;
            align-items: center;
            padding: .75rem 1rem;
            border-radius: 12px;
            color: var(--ink);
            text-decoration: none;
        }

        .sidebar .menu li a:hover {
            background: var(--soft);
        }

        .sidebar .menu li a.active {
            background: rgba(122, 108, 255, .12);
            font-weight: 600;
        }

        /* Toggle button */
        .sidebar-toggle-btn {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 1001;
            background: var(--btn);
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.3s ease-in-out;
            /* Added transition for smooth movement */
        }

        .sidebar-toggle-btn i {
            color: var(--ink);
            font-size: 20px;
        }

        @media (min-width:768px) {
            body.sidebar-open {
                padding-left: 280px;
            }

            .sidebar-toggle-btn {
                left: 16px;
            }

            /* Stays on the left */
            .sidebar.is-open+.sidebar-toggle-btn {
                left: 296px;
            }

            /* Moves with the sidebar */
        }

        @media (max-width:640px) {
            .sidebar {
                width: 84vw;
                max-width: 320px;
            }
        }

        /* Amanin layout */
        header .brand {
            position: relative;
            z-index: 1002;
            padding-left: 60px;
        }

        @media (max-width:767px) {
            header .brand {
                padding-left: 0;
            }

            .sidebar-toggle-btn {
                top: calc(16px + env(safe-area-inset-top));
            }
        }

        /* CSS untuk ujian ketik jawaban */
        #fcPrompt {
            word-break: keep-all
        }

        #fcFeedback.ok {
            color: var(--ok)
        }

        #fcFeedback.bad {
            color: var(--warn)
        }

        #fcFeedback .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--pri);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Form look & feel */
        input,
        select,
        textarea,
        input[type="number"],
        input[type="text"] {
            height: 52px;
            padding: 0 14px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--panel);
            color: var(--ink);
            box-shadow: var(--shadow);
            transition: box-shadow var(--transition-duration) ease, border-color var(--transition-duration) ease, background var(--transition-duration) ease;
        }

        input::placeholder {
            color: var(--muted);
        }

        /* Focus ring */
        input:focus,
        select:focus,
        textarea:focus,
        input[type="number"]:focus,
        input[type="text"]:focus {
            outline: none;
            box-shadow: var(--ring);
            border-color: transparent;
        }

        /* Number tidy (hapus spinner di mobile/Chromium) */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Select arrow padding sudah di CSS; tambahkan height konsisten */
        select {
            height: 52px;
        }

        /* ========================================================== */
        /* === MOBILE 720p OPTIMIZATIONS === */
        /* ========================================================== */
        @media (max-width: 767px) {

            /* Vocab item jadi column di mobile */
            .vocab-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
                padding: 10px 8px;
            }

            .vocab-jp {
                flex-shrink: 1;
                font-size: 18px;
                word-break: break-word;
                max-width: 100%;
            }

            .vocab-jp .kana {
                display: block;
                margin-left: 0;
                margin-top: 2px;
            }

            .vocab-id {
                text-align: left;
                width: 100%;
            }

            .vocab-id .arti {
                font-size: 14px;
            }

            .vocab-item i {
                position: absolute;
                right: 8px;
                top: 50%;
                transform: translateY(-50%);
            }

            /* Card dan button lebih compact */
            .card {
                padding: 12px !important;
            }

            .btn {
                min-height: 44px;
                padding: 0 12px;
                font-size: 13px;
            }

            /* Filter chips lebih kecil */
            .chip-filter {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 400px) {
            .vocab-jp {
                font-size: 16px;
            }

            .vocab-id .arti {
                font-size: 13px;
            }
        }
    </style>
</head>

<body>
    <!-- Toggle Button (burger) -->
    <button id="sidebarToggle" class="sidebar-toggle-btn" aria-label="Toggle Sidebar">
        <i class="fa-solid fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar">
        <div class="row" style="justify-content: space-between; align-items: center;">
            <h3 style="margin:0;">Navigasi</h3>
            <button class="btn ghost" id="closeSidebar" aria-label="Tutup Sidebar">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <hr style="border:none;border-top:1px solid var(--border);width:100%;">
        <ul class="menu">
            <li><a href="index.html">ğŸ“˜ Latihan</a></li>
            <li><a href="index2.html">ğŸ—‚ï¸ Flashcard</a></li>
            <li><a href="index3.html">ğŸ§® Tabel Kana</a></li>
            <li><a href="index4.html" class="active">ğŸ—’ï¸ Kosakata</a></li>
            <li><a href="index5.html">ğŸ’¬ Ungkapan</a></li>
            <!-- Penambahan: Item menu "Tebak Arti" -->
            <li><a href="index7.html">ğŸ§  Tebak Arti</a></li>
            <li><a href="index6.html">âœï¸ Menulis</a></li>
            <li><a href="index8.html">ğŸ“š Pelatih Membaca</a></li> <!-- Menambahkan link ke index8.html -->
        </ul>
    </nav>

    <header>
        <div class="wrap">
            <div class="brand">
                <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="36" height="36">
                    <defs>
                        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                            <stop stop-color="#7a6cff" />
                            <stop offset="1" stop-color="#16c6a1" />
                        </linearGradient>
                    </defs>
                    <rect width="64" height="64" rx="14" fill="url(#g)" />
                    <text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle"
                        font-family="Noto Sans JP, 'Noto Serif JP', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"
                        font-size="38" fill="white" dy="-2">ã‚</text>
                </svg>
                <div>
                    <h1>Pelatih Kana Jepang</h1>
                    <div class="small">Daftar Kosakata (N5 & N4)</div>
                </div>
            </div>
            <!-- NAVIGASI UTAMA (LAMA - TERSEMBUNYI) -->
            <nav class="main-nav">
                <div class="row">
                    <a href="index.html" class="btn ghost"><i class="fa-solid fa-home"></i> Latihan</a>
                    <a href="index2.html" class="btn ghost"><i class="fa-solid fa-clone"></i> Flashcard</a>
                    <a href="index3.html" class="btn ghost"><i class="fa-solid fa-table"></i> Tabel Kana</a>
                    <a href="index4.html" class="btn primary"><i class="fa-solid fa-book-open"></i> Kosakata</a>
                    <a href="index5.html" class="btn ghost"><i class="fa-solid fa-comments"></i> Ungkapan</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="wrap">
        <div class="card">
            <h2><i class="fa-solid fa-book-open icon"></i> Kosakata (å˜èª)</h2>
            <div class="small">Cari kosakata atau filter berdasarkan level dan kategori. Klik pada kata untuk
                mendengarkan pelafalannya.</div>
            <div class="spacer"></div>
            <input type="search" id="searchInput" placeholder="Cari kata (e.g., 'neko', 'kucing', 'ã­ã“')...">

            <!-- Filter Level (Baru) -->
            <h3 class="filter-label" style="margin-top: 16px;">Filter Level</h3>
            <div id="levelChips" class="chips">
                <!-- Level akan digenerate oleh JavaScript -->
            </div>

            <!-- Filter Kategori (Lama, tapi sekarang dinamis) -->
            <h3 class="filter-label">Filter Kategori</h3>
            <div id="categoryChips" class="chips">
                <!-- Kategori akan digenerate oleh JavaScript -->
            </div>
        </div>

        <div class="spacer"></div>

        <!-- Penambahan: CTA card "Tebak Arti" -->
        <div class="card" id="cta-tebak-arti">
            <h2><i class="fa-solid fa-brain icon"></i> Tebak Arti (JPâ†’ID)</h2>
            <div class="small">Kuis arti Jepang â†’ Indonesia (Aâ€“D). Pilih kategori & jumlah soal.</div>
            <div class="spacer"></div>
            <div class="row" style="gap:8px;flex-wrap:wrap">
                <a class="btn primary" href="index7.html"><i class="fa-solid fa-play"></i> Mulai Tebak Arti</a>
                <a class="btn ghost" href="index7.html#kategori"><i class="fa-solid fa-list"></i> Pilih Kategori</a>
            </div>
        </div>

        <div class="spacer"></div>

        <div class="card">
            <ul id="vocabList" class="vocab-list">
                <!-- Daftar kosakata akan digenerate oleh JavaScript -->
            </ul>
        </div>

        <div class="spacer"></div>

        <!-- === Flashcard Ketik Jawaban (Ujian) === -->
        <div class="card" style="grid-column:span 12">
            <h3><i class="fa-solid fa-rectangle-list icon"></i> Ujian â€” Ketik Jawaban</h3>

            <div class="row">
                <select id="fcMode" class="input" aria-label="Mode pertanyaan">
                    <option value="jp_idn">JP â†’ Arti (ketik arti)</option>
                    <option value="jp_ro">JP â†’ Romaji (ketik romaji)</option>
                    <option value="idn_jp">Arti â†’ JP (ketik kana/kanji)</option>
                    <option value="ro_jp">Romaji â†’ JP (ketik kana/kanji)</option>
                    <option value="ai_gen_jp_idn">AI Gen: JP â†’ Arti (ketik arti)</option> <!-- New AI mode -->
                </select>
                <select id="fcSource" class="input" aria-label="Sumber kartu">
                    <option value="filter">Dari hasil filter</option>
                    <option value="fav">Hanya favorit</option>
                    <option value="rand20">Acak 20</option>
                    <option value="ai_gen">AI Generate (Kategori Aktif)</option> <!-- New AI source -->
                </select>
                <button class="btn primary" id="fcStart">Mulai</button>
            </div>

            <div class="spacer"></div>

            <div id="fcArea" hidden>
                <div class="small" id="fcProgress">0 / 0</div>
                <div id="fcPrompt" class="center" style="font-size:28px;margin:10px 0 16px"></div>

                <div style="max-width:520px;margin:0 auto">
                    <input id="fcInput" class="input" placeholder="Ketik jawabanâ€¦" autocomplete="off"
                        autocapitalize="none" aria-label="Jawaban">
                    <div class="row" style="justify-content:center;margin-top:10px;gap:8px">
                        <button class="btn" id="fcCheck">Cek (Enter)</button>
                        <button class="btn ghost" id="fcReveal">Lihat jawaban</button>
                        <button class="btn" id="fcNext" disabled>Berikutnya (Tab)</button>
                    </div>
                    <div class="small center" id="fcFeedback" style="min-height:22px;margin-top:8px"></div>
                </div>
            </div>
        </div>

        <!-- Link ke website Kotobaku -->
        <div class="card" style="margin-top: 16px; text-align: center;">
            <h3 style="margin: 0 0 8px 0; font-size: 14px; color: var(--muted);">ğŸ”— Belajar Lebih Lanjut</h3>
            <a href="https://kotoba-jpn.vercel.app" target="_blank" rel="noopener noreferrer" class="btn primary"
                style="width: 100%;">
                <i class="fa-solid fa-external-link-alt"></i> Kunjungi Kotobaku
            </a>
            <div class="small" style="margin-top: 8px;">Website belajar kosakata Jepang tambahan</div>
        </div>
    </main>

    <script>
        // DATA KOSAKATA (N5 & N4)
        // Menambahkan properti 'level' untuk N5 dan N4
        const vocabulary = [
            // --- N5: Salam dan Frasa Dasar ---
            { id: 'konnichiwa', kana: 'ã“ã‚“ã«ã¡ã¯', kanji: 'ä»Šæ—¥ã¯', romaji: 'konnichiwa', arti: 'Halo / Selamat siang', kategori: 'salam', level: 'n5' },
            { id: 'ohayougozaimasu', kana: 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™', kanji: '', romaji: 'ohayou gozaimasu', arti: 'Selamat pagi', kategori: 'salam', level: 'n5' },
            { id: 'konbanwa', kana: 'ã“ã‚“ã°ã‚“ã¯', kanji: 'ä»Šæ™©ã¯', romaji: 'konbanwa', arti: 'Selamat malam', kategori: 'salam', level: 'n5' },
            { id: 'oyasuminasai', kana: 'ãŠã‚„ã™ã¿ãªã•ã„', kanji: 'ãŠä¼‘ã¿ãªã•ã„', romaji: 'oyasuminasai', arti: 'Selamat tidur', kategori: 'salam', level: 'n5' },
            { id: 'sayounara', kana: 'ã•ã‚ˆã†ãªã‚‰', kanji: '', romaji: 'sayounara', arti: 'Selamat tinggal', kategori: 'salam', level: 'n5' },
            { id: 'arigatou', kana: 'ã‚ã‚ŠãŒã¨ã†', kanji: '', romaji: 'arigatou', arti: 'Terima kasih', kategori: 'salam', level: 'n5' },
            { id: 'arigatougozaimasu', kana: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', kanji: '', romaji: 'arigatou gozaimasu', arti: 'Terima kasih (formal)', kategori: 'salam', level: 'n5' },
            { id: 'sumimasen', kana: 'ã™ã¿ã¾ã›ã‚“', kanji: '', romaji: 'sumimasen', arti: 'Maaf / Permisi / Terima kasih', kategori: 'salam', level: 'n5' },
            { id: 'gomennasai', kana: 'ã”ã‚ã‚“ãªã•ã„', kanji: '', romaji: 'gomen nasai', arti: 'Maafkan saya', kategori: 'salam', level: 'n5' },
            { id: 'hai', kana: 'ã¯ã„', kanji: '', romaji: 'hai', arti: 'Ya', kategori: 'dasar', level: 'n5' },
            { id: 'iie', kana: 'ã„ã„ãˆ', kanji: '', romaji: 'iie', arti: 'Tidak / Bukan', kategori: 'dasar', level: 'n5' },
            { id: 'onegaishimasu', kana: 'ãŠã­ãŒã„ã—ã¾ã™', kanji: 'ãŠé¡˜ã„ã—ã¾ã™', romaji: 'onegai shimasu', arti: 'Mohon / Tolong', kategori: 'dasar', level: 'n5' },
            { id: 'douzo', kana: 'ã©ã†ã', kanji: '', romaji: 'douzo', arti: 'Silakan', kategori: 'dasar', level: 'n5' },
            { id: 'hajimemashite', kana: 'ã¯ã˜ã‚ã¾ã—ã¦', kanji: '', romaji: 'hajimemashite', arti: 'Senang bertemu dengan Anda (perkenalan)', kategori: 'salam', level: 'n5' },
            { id: 'yoroshikuonegaishimasu', kana: 'ã‚ˆã‚ã—ããŠã­ãŒã„ã—ã¾ã™', kanji: 'ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™', romaji: 'yoroshiku onegai shimasu', arti: 'Mohon bantuannya (saat perkenalan)', kategori: 'salam', level: 'n5' },
            { id: 'itadakimasu', kana: 'ã„ãŸã ãã¾ã™', kanji: '', romaji: 'itadakimasu', arti: 'Selamat makan (sebelum makan)', kategori: 'makanan', level: 'n5' },
            { id: 'gochisousamadeshita', kana: 'ã”ã¡ãã†ã•ã¾ã§ã—ãŸ', kanji: '', romaji: 'gochisousama deshita', arti: 'Terima kasih atas makanannya (setelah makan)', kategori: 'makanan', level: 'n5' },

            // --- N5: Orang dan Keluarga ---
            { id: 'watashi', kana: 'ã‚ãŸã—', kanji: 'ç§', romaji: 'watashi', arti: 'Saya', kategori: 'orang', level: 'n5' },
            { id: 'anata', kana: 'ã‚ãªãŸ', kanji: 'è²´æ–¹', romaji: 'anata', arti: 'Anda / Kamu', kategori: 'orang', level: 'n5' },
            { id: 'anohito', kana: 'ã‚ã®ã²ã¨', kanji: 'ã‚ã®äºº', romaji: 'ano hito', arti: 'Orang itu', kategori: 'orang', level: 'n5' },
            { id: 'sensei', kana: 'ã›ã‚“ã›ã„', kanji: 'å…ˆç”Ÿ', romaji: 'sensei', arti: 'Guru', kategori: 'orang', level: 'n5' },
            { id: 'gakusei', kana: 'ãŒãã›ã„', kanji: 'å­¦ç”Ÿ', romaji: 'gakusei', arti: 'Murid / Pelajar', kategori: 'orang', level: 'n5' },
            { id: 'kaishain', kana: 'ã‹ã„ã—ã‚ƒã„ã‚“', kanji: 'ä¼šç¤¾å“¡', romaji: 'kaishain', arti: 'Karyawan perusahaan', kategori: 'orang', level: 'n5' },
            { id: 'isha', kana: 'ã„ã—ã‚ƒ', kanji: 'åŒ»è€…', romaji: 'isha', arti: 'Dokter', kategori: 'orang', level: 'n5' },
            { id: 'otousan', kana: 'ãŠã¨ã†ã•ã‚“', kanji: 'ãŠçˆ¶ã•ã‚“', romaji: 'otousan', arti: 'Ayah', kategori: 'keluarga', level: 'n5' },
            { id: 'okaasan', kana: 'ãŠã‹ã‚ã•ã‚“', kanji: 'ãŠæ¯ã•ã‚“', romaji: 'okaasan', arti: 'Ibu', kategori: 'keluarga', level: 'n5' },
            { id: 'oniisan', kana: 'ãŠã«ã„ã•ã‚“', kanji: 'ãŠå…„ã•ã‚“', romaji: 'oniisan', arti: 'Kakak laki-laki', kategori: 'keluarga', level: 'n5' },
            { id: 'oneesan', kana: 'ãŠã­ãˆã•ã‚“', kanji: 'ãŠå§‰ã•ã‚“', romaji: 'oneesan', arti: 'Kakak perempuan', kategori: 'keluarga', level: 'n5' },
            { id: 'otouto', kana: 'ãŠã¨ã†ã¨', kanji: 'å¼Ÿ', romaji: 'otouto', arti: 'Adik laki-laki', kategori: 'keluarga', level: 'n5' },
            { id: 'imouto', kana: 'ã„ã‚‚ã†ã¨', kanji: 'å¦¹', romaji: 'imouto', arti: 'Adik perempuan', kategori: 'keluarga', level: 'n5' },
            { id: 'kodomo', kana: 'ã“ã©ã‚‚', kanji: 'å­ä¾›', romaji: 'kodomo', arti: 'Anak-anak', kategori: 'keluarga', level: 'n5' },
            { id: 'tomodachi', kana: 'ã¨ã‚‚ã ã¡', kanji: 'å‹é”', romaji: 'tomodachi', arti: 'Teman', kategori: 'orang', level: 'n5' },

            // --- N5: Angka ---
            { id: 'ichi', kana: 'ã„ã¡', kanji: 'ä¸€', romaji: 'ichi', arti: 'Satu', kategori: 'angka', level: 'n5' },
            { id: 'ni', kana: 'ã«', kanji: 'äºŒ', romaji: 'ni', arti: 'Dua', kategori: 'angka', level: 'n5' },
            { id: 'san', kana: 'ã•ã‚“', kanji: 'ä¸‰', romaji: 'san', arti: 'Tiga', kategori: 'angka', level: 'n5' },
            { id: 'shi/yon', kana: 'ã— / ã‚ˆã‚“', kanji: 'å››', romaji: 'shi / yon', arti: 'Empat', kategori: 'angka', level: 'n5' },
            { id: 'go', kana: 'ã”', kanji: 'äº”', romaji: 'go', arti: 'Lima', kategori: 'angka', level: 'n5' },
            { id: 'roku', kana: 'ã‚ã', kanji: 'å…­', romaji: 'roku', arti: 'Enam', kategori: 'angka', level: 'n5' },
            { id: 'shichi/nana', kana: 'ã—ã¡ / ãªãª', kanji: 'ä¸ƒ', romaji: 'shichi / nana', arti: 'Tujuh', kategori: 'angka', level: 'n5' },
            { id: 'hachi', kana: 'ã¯ã¡', kanji: 'å…«', romaji: 'hachi', arti: 'Delapan', kategori: 'angka', level: 'n5' },
            { id: 'kyuu/ku', kana: 'ãã‚…ã† / ã', kanji: 'ä¹', romaji: 'kyuu / ku', arti: 'Sembilan', kategori: 'angka', level: 'n5' },
            { id: 'juu', kana: 'ã˜ã‚…ã†', kanji: 'å', romaji: 'juu', arti: 'Sepuluh', kategori: 'angka', level: 'n5' },
            { id: 'hyaku', kana: 'ã²ã‚ƒã', kanji: 'ç™¾', romaji: 'hyaku', arti: 'Seratus', kategori: 'angka', level: 'n5' },
            { id: 'sen', kana: 'ã›ã‚“', kanji: 'åƒ', romaji: 'sen', arti: 'Seribu', kategori: 'angka', level: 'n5' },
            { id: 'man', kana: 'ã¾ã‚“', kanji: 'ä¸‡', romaji: 'man', arti: 'Sepuluh ribu', kategori: 'angka', level: 'n5' },

            // --- N5: Tempat dan Lokasi ---
            { id: 'nihon', kana: 'ã«ã»ã‚“', kanji: 'æ—¥æœ¬', romaji: 'nihon', arti: 'Jepang', kategori: 'tempat', level: 'n5' },
            { id: 'gakkou', kana: 'ãŒã£ã“ã†', kanji: 'å­¦æ ¡', romaji: 'gakkou', arti: 'Sekolah', kategori: 'tempat', level: 'n5' },
            { id: 'eki', kana: 'ãˆã', kanji: 'é§…', romaji: 'eki', arti: 'Stasiun', kategori: 'tempat', level: 'n5' },
            { id: 'ie/uchi', kana: 'ã„ãˆ / ã†ã¡', kanji: 'å®¶', romaji: 'ie / uchi', arti: 'Rumah', kategori: 'tempat', level: 'n5' },
            { id: 'kaisha', kana: 'ã‹ã„ã—ã‚ƒ', kanji: 'ä¼šç¤¾', romaji: 'kaisha', arti: 'Kantor / Perusahaan', kategori: 'tempat', level: 'n5' }, // Romaji diperbaiki
            { id: 'ginkou', kana: 'ãã‚“ã“ã†', kanji: 'éŠ€è¡Œ', romaji: 'ginkou', arti: 'Bank', kategori: 'tempat', level: 'n5' },
            { id: 'byouin', kana: 'ã³ã‚‡ã†ã„ã‚“', kanji: 'ç—…é™¢', romaji: 'byouin', arti: 'Rumah sakit', kategori: 'tempat', level: 'n5' },
            { id: 'resutoran', kana: 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', kanji: '', romaji: 'resutoran', arti: 'Restoran', kategori: 'tempat', level: 'n5' },
            { id: 'suupaa', kana: 'ã‚¹ãƒ¼ãƒ‘ãƒ¼', kanji: '', romaji: 'suupaa', arti: 'Supermarket', kategori: 'tempat', level: 'n5' },
            { id: 'depaato', kana: 'ãƒ‡ãƒ‘ãƒ¼ãƒˆ', kanji: '', romaji: 'depaato', arti: 'Toserba', kategori: 'tempat', level: 'n5' },
            { id: 'machi', kana: 'ã¾ã¡', kanji: 'ç”º', romaji: 'machi', arti: 'Kota', kategori: 'tempat', level: 'n5' },
            { id: 'kuni', kana: 'ãã«', kanji: 'å›½', romaji: 'kuni', arti: 'Negara', kategori: 'tempat', level: 'n5' },
            { id: 'heya', kana: 'ã¸ã‚„', kanji: 'éƒ¨å±‹', romaji: 'heya', arti: 'Kamar', kategori: 'tempat', level: 'n5' },
            { id: 'toire', kana: 'ãƒˆã‚¤ãƒ¬', kanji: '', romaji: 'toire', arti: 'Toilet', kategori: 'tempat', level: 'n5' },
            { id: 'daigaku', kana: 'ã ã„ãŒã', kanji: 'å¤§å­¦', romaji: 'daigaku', arti: 'Universitas', kategori: 'tempat', level: 'n5' },
            { id: 'mise', kana: 'ã¿ã›', kanji: 'åº—', romaji: 'mise', arti: 'Toko', kategori: 'tempat', level: 'n5' },

            // --- N5: Makanan dan Minuman ---
            { id: 'gohan', kana: 'ã”ã¯ã‚“', kanji: 'ã”é£¯', romaji: 'gohan', arti: 'Nasi / Makanan', kategori: 'makanan', level: 'n5' },
            { id: 'pan', kana: 'ãƒ‘ãƒ³', kanji: '', romaji: 'pan', arti: 'Roti', kategori: 'makanan', level: 'n5' },
            { id: 'mizu', kana: 'ã¿ãš', kanji: 'æ°´', romaji: 'mizu', arti: 'Air', kategori: 'minuman', level: 'n5' },
            { id: 'ocha', kana: 'ãŠã¡ã‚ƒ', kanji: 'ãŠèŒ¶', romaji: 'ocha', arti: 'Teh', kategori: 'minuman', level: 'n5' },
            { id: 'koohii', kana: 'ã‚³ãƒ¼ãƒ’ãƒ¼', kanji: '', romaji: 'koohii', arti: 'Kopi', kategori: 'minuman', level: 'n5' },
            { id: 'gyuunyuu', kana: 'ãã‚…ã†ã«ã‚…ã†', kanji: 'ç‰›ä¹³', romaji: 'gyuunyuu', arti: 'Susu', kategori: 'minuman', level: 'n5' },
            { id: 'niku', kana: 'ã«ã', kanji: 'è‚‰', romaji: 'niku', arti: 'Daging', kategori: 'makanan', level: 'n5' },
            { id: 'sakana', kana: 'ã•ã‹ãª', kanji: 'é­š', romaji: 'sakana', arti: 'Ikan', kategori: 'makanan', level: 'n5' },
            { id: 'yasai', kana: 'ã‚„ã•ã„', kanji: 'é‡èœ', romaji: 'yasai', arti: 'Sayur', kategori: 'makanan', level: 'n5' },
            { id: 'kudamono', kana: 'ãã ã‚‚ã®', kanji: 'æœç‰©', romaji: 'kudamono', arti: 'Buah', kategori: 'makanan', level: 'n5' },
            { id: 'tamago', kana: 'ãŸã¾ã”', kanji: 'åµ', romaji: 'tamago', arti: 'Telur', kategori: 'makanan', level: 'n5' },
            { id: 'juusu', kana: 'ã‚¸ãƒ¥ãƒ¼ã‚¹', kanji: '', romaji: 'juusu', arti: 'Jus', kategori: 'minuman', level: 'n5' },
            { id: 'biiru', kana: 'ãƒ“ãƒ¼ãƒ«', kanji: '', romaji: 'biiru', arti: 'Bir', kategori: 'minuman', level: 'n5' },

            // --- N5: Kata Kerja ---
            { id: 'taberu', kana: 'ãŸã¹ã‚‹', kanji: 'é£Ÿã¹ã‚‹', romaji: 'taberu', arti: 'Makan', kategori: 'kerja', level: 'n5' },
            { id: 'nomu', kana: 'ã®ã‚€', kanji: 'é£²ã‚€', romaji: 'nomu', arti: 'Minum', kategori: 'kerja', level: 'n5' },
            { id: 'miru', kana: 'ã¿ã‚‹', kanji: 'è¦‹ã‚‹', romaji: 'miru', arti: 'Melihat', kategori: 'kerja', level: 'n5' },
            { id: 'kiku', kana: 'ãã', kanji: 'èã', romaji: 'kiku', arti: 'Mendengar / Bertanya', kategori: 'kerja', level: 'n5' },
            { id: 'hanasu', kana: 'ã¯ãªã™', kanji: 'è©±ã™', romaji: 'hanasu', arti: 'Berbicara', kategori: 'kerja', level: 'n5' },
            { id: 'yomu', kana: 'ã‚ˆã‚€', kanji: 'èª­ã‚€', romaji: 'yomu', arti: 'Membaca', kategori: 'kerja', level: 'n5' },
            { id: 'kaku', kana: 'ã‹ã', kanji: 'æ›¸ã', romaji: 'kaku', arti: 'Menulis', kategori: 'kerja', level: 'n5' },
            { id: 'iku', kana: 'ã„ã', kanji: 'è¡Œã', romaji: 'iku', arti: 'Pergi', kategori: 'kerja', level: 'n5' },
            { id: 'kuru', kana: 'ãã‚‹', kanji: 'æ¥ã‚‹', romaji: 'kuru', arti: 'Datang', kategori: 'kerja', level: 'n5' },
            { id: 'kaeru', kana: 'ã‹ãˆã‚‹', kanji: 'å¸°ã‚‹', romaji: 'kaeru', arti: 'Pulang', kategori: 'kerja', level: 'n5' },
            { id: 'neru', kana: 'ã­ã‚‹', kanji: 'å¯ã‚‹', romaji: 'neru', arti: 'Tidur', kategori: 'kerja', level: 'n5' },
            { id: 'okiru', kana: 'ãŠãã‚‹', kanji: 'èµ·ãã‚‹', romaji: 'okiru', arti: 'Bangun', kategori: 'kerja', level: 'n5' },
            { id: 'benkyousuru', kana: 'ã¹ã‚“ãã‚‡ã†ã™ã‚‹', kanji: 'å‹‰å¼·ã™ã‚‹', romaji: 'benkyou suru', arti: 'Belajar', kategori: 'kerja', level: 'n5' },
            { id: 'shigotowosuru', kana: 'ã—ã”ã¨ã‚’ã™ã‚‹', kanji: 'ä»•äº‹ã‚’ã™ã‚‹', romaji: 'shigoto wo suru', arti: 'Bekerja', kategori: 'kerja', level: 'n5' },
            { id: 'wakaru', kana: 'ã‚ã‹ã‚‹', kanji: 'åˆ†ã‹ã‚‹', romaji: 'wakaru', arti: 'Mengerti', kategori: 'kerja', level: 'n5' },
            { id: 'shiru', kana: 'ã—ã‚‹', kanji: 'çŸ¥ã‚‹', romaji: 'shiru', arti: 'Tahu', kategori: 'kerja', level: 'n5' },
            { id: 'motsu', kana: 'ã‚‚ã¤', kanji: 'æŒã¤', romaji: 'motsu', arti: 'Membawa / Memiliki', kategori: 'kerja', level: 'n5' },
            { id: 'kau', kana: 'ã‹ã†', kanji: 'è²·ã†', romaji: 'kau', arti: 'Membeli', kategori: 'kerja', level: 'n5' },
            { id: 'uru', kana: 'ã†ã‚‹', kanji: 'å£²ã‚‹', romaji: 'uru', arti: 'Menjual', kategori: 'kerja', level: 'n5' },
            { id: 'aru', kana: 'ã‚ã‚‹', kanji: 'æœ‰ã‚‹', romaji: 'aru', arti: 'Ada (benda mati)', kategori: 'kerja', level: 'n5' },
            { id: 'iru', kana: 'ã„ã‚‹', kanji: 'å±…ã‚‹', romaji: 'iru', arti: 'Ada (makhluk hidup)', kategori: 'kerja', level: 'n5' },

            // --- N5: Kata Sifat (i-keiyoushi) ---
            { id: 'ookii', kana: 'ãŠãŠãã„', kanji: 'å¤§ãã„', romaji: 'ookii', arti: 'Besar', kategori: 'sifat-i', level: 'n5' },
            { id: 'chiisai', kana: 'ã¡ã„ã•ã„', kanji: 'å°ã•ã„', romaji: 'chiisai', arti: 'Kecil', kategori: 'sifat-i', level: 'n5' },
            { id: 'atarashii', kana: 'ã‚ãŸã‚‰ã—ã„', kanji: 'æ–°ã—ã„', romaji: 'atarashii', arti: 'Baru', kategori: 'sifat-i', level: 'n5' },
            { id: 'furui', kana: 'ãµã‚‹ã„', kanji: 'å¤ã„', romaji: 'furui', arti: 'Lama / Tua', kategori: 'sifat-i', level: 'n5' },
            { id: 'yoi/ii', kana: 'ã‚ˆã„ / ã„ã„', kanji: 'è‰¯ã„', romaji: 'yoi / ii', arti: 'Baik', kategori: 'sifat-i', level: 'n5' },
            { id: 'warui', kana: 'ã‚ã‚‹ã„', kanji: 'æ‚ªã„', romaji: 'warui', arti: 'Jelek / Buruk', kategori: 'sifat-i', level: 'n5' },
            { id: 'takai', kana: 'ãŸã‹ã„', kanji: 'é«˜ã„', romaji: 'takai', arti: 'Tinggi / Mahal', kategori: 'sifat-i', level: 'n5' },
            { id: 'yasui', kana: 'ã‚„ã™ã„', kanji: 'å®‰ã„', romaji: 'yasui', arti: 'Murah', kategori: 'sifat-i', level: 'n5' },
            { id: 'hikui', kana: 'ã²ãã„', kanji: 'ä½ã„', romaji: 'hikui', arti: 'Rendah', kategori: 'sifat-i', level: 'n5' },
            { id: 'samui', kana: 'ã•ã‚€ã„', kanji: 'å¯’ã„', romaji: 'samui', arti: 'Dingin (cuaca)', kategori: 'sifat-i', level: 'n5' },
            { id: 'atsui_weather', kana: 'ã‚ã¤ã„', kanji: 'æš‘ã„', romaji: 'atsui', arti: 'Panas (cuaca)', kategori: 'sifat-i', level: 'n5' },
            { id: 'tsumetai', kana: 'ã¤ã‚ãŸã„', kanji: 'å†·ãŸã„', romaji: 'tsumetai', arti: 'Dingin (benda)', kategori: 'sifat-i', level: 'n5' },
            { id: 'isogashii', kana: 'ã„ããŒã—ã„', kanji: 'å¿™ã—ã„', romaji: 'isogashii', arti: 'Sibuk', kategori: 'sifat-i', level: 'n5' },
            { id: 'tanoshii', kana: 'ãŸã®ã—ã„', kanji: 'æ¥½ã—ã„', romaji: 'tanoshii', arti: 'Menyenangkan', kategori: 'sifat-i', level: 'n5' },
            { id: 'muzukashii', kana: 'ã‚€ãšã‹ã—ã„', kanji: 'é›£ã—ã„', romaji: 'muzukashii', arti: 'Sulit', kategori: 'sifat-i', level: 'n5' },
            { id: 'yasashii', kana: 'ã‚„ã•ã—ã„', kanji: 'æ˜“ã—ã„', romaji: 'yasashii', arti: 'Mudah', kategori: 'sifat-i', level: 'n5' },
            { id: 'yasashii_kind', kana: 'ã‚„ã•ã—ã„', kanji: 'å„ªã—ã„', romaji: 'yasashii', arti: 'Baik hati', kategori: 'sifat-i', level: 'n5' },
            { id: 'oishii', kana: 'ãŠã„ã—ã„', kanji: 'ç¾å‘³ã—ã„', romaji: 'oishii', arti: 'Enak', kategori: 'sifat-i', level: 'n5' },
            { id: 'mazui', kana: 'ã¾ãšã„', kanji: 'ä¸å‘³ã„', romaji: 'mazui', arti: 'Tidak enak', kategori: 'sifat-i', level: 'n5' },

            // --- N5: Kata Sifat (na-keiyoushi) ---
            { id: 'kirei', kana: 'ãã‚Œã„', kanji: 'ç¶ºéº—', romaji: 'kirei', arti: 'Cantik / Bersih', kategori: 'sifat-na', level: 'n5' },
            { id: 'shizuka', kana: 'ã—ãšã‹', kanji: 'é™ã‹', romaji: 'shizuka', arti: 'Tenang / Sunyi', kategori: 'sifat-na', level: 'n5' },
            { id: 'nigiyaka', kana: 'ã«ãã‚„ã‹', kanji: 'è³‘ã‚„ã‹', romaji: 'nigiyaka', arti: 'Ramai / Sibuk (tempat)', kategori: 'sifat-na', level: 'n5' },
            { id: 'yuumei', kana: 'ã‚†ã†ã‚ã„', kanji: 'æœ‰å', romaji: 'yuumei', arti: 'Terkenal', kategori: 'sifat-na', level: 'n5' },
            { id: 'genki', kana: 'ã’ã‚“ã', kanji: 'å…ƒæ°—', romaji: 'genki', arti: 'Sehat / Semangat', kategori: 'sifat-na', level: 'n5' },
            { id: 'benri', kana: 'ã¹ã‚“ã‚Š', kanji: 'ä¾¿åˆ©', romaji: 'benri', arti: 'Praktis / Nyaman', kategori: 'sifat-na', level: 'n5' },
            { id: 'fuben', kana: 'ãµã¹ã‚“', kanji: 'ä¸ä¾¿', romaji: 'fuben', arti: 'Tidak praktis / Tidak nyaman', kategori: 'sifat-na', level: 'n5' },
            { id: 'jouzu', kana: 'ã˜ã‚‡ã†ãš', kanji: 'ä¸Šæ‰‹', romaji: 'jouzu', arti: 'Mahir / Pandai', kategori: 'sifat-na', level: 'n5' },
            { id: 'heta', kana: 'ã¸ãŸ', kanji: 'ä¸‹æ‰‹', romaji: 'heta', arti: 'Tidak mahir / Canggung', kategori: 'sifat-na', level: 'n5' },
            { id: 'hima', kana: 'ã²ã¾', kanji: 'æš‡', romaji: 'hima', arti: 'Senggang / Luang', kategori: 'sifat-na', level: 'n5' },
            { id: 'suki', kana: 'ã™ã', kanji: 'å¥½ã', romaji: 'suki', arti: 'Suka', kategori: 'sifat-na', level: 'n5' },
            { id: 'kirai', kana: 'ãã‚‰ã„', kanji: 'å«Œã„', romaji: 'kirai', arti: 'Benci', kategori: 'sifat-na', level: 'n5' },

            // --- N5: Kata Benda Umum ---
            { id: 'hon', kana: 'ã»ã‚“', kanji: 'æœ¬', romaji: 'hon', arti: 'Buku', kategori: 'benda', level: 'n5' },
            { id: 'kaban', kana: 'ã‹ã°ã‚“', kanji: '', romaji: 'kaban', arti: 'Tas', kategori: 'benda', level: 'n5' },
            { id: 'tsukue', kana: 'ã¤ããˆ', kanji: 'æœº', romaji: 'tsukue', arti: 'Meja', kategori: 'benda', level: 'n5' },
            { id: 'isu', kana: 'ã„ã™', kanji: 'æ¤…å­', romaji: 'isu', arti: 'Kursi', kategori: 'benda', level: 'n5' },
            { id: 'tegami', kana: 'ã¦ãŒã¿', kanji: 'æ‰‹ç´™', romaji: 'tegami', arti: 'Surat', kategori: 'benda', level: 'n5' },
            { id: 'eiga', kana: 'ãˆã„ãŒ', kanji: 'æ˜ ç”»', romaji: 'eiga', arti: 'Film', kategori: 'benda', level: 'n5' },
            { id: 'ongaku', kana: 'ãŠã‚“ãŒã', kanji: 'éŸ³æ¥½', romaji: 'ongaku', arti: 'Musik', kategori: 'benda', level: 'n5' },
            { id: 'terebi', kana: 'ãƒ†ãƒ¬ãƒ“', kanji: '', romaji: 'terebi', arti: 'Televisi', kategori: 'benda', level: 'n5' },
            { id: 'kuruma', kana: 'ãã‚‹ã¾', kanji: 'è»Š', romaji: 'kuruma', arti: 'Mobil', kategori: 'transportasi', level: 'n5' },
            { id: 'densha', kana: 'ã§ã‚“ã—ã‚ƒ', kanji: 'é›»è»Š', romaji: 'densha', arti: 'Kereta listrik', kategori: 'transportasi', level: 'n5' },
            { id: 'basu', kana: 'ãƒã‚¹', kanji: '', romaji: 'basu', arti: 'Bus', kategori: 'transportasi', level: 'n5' },
            { id: 'hikouki', kana: 'ã²ã“ã†ã', kanji: 'é£›è¡Œæ©Ÿ', romaji: 'hikouki', arti: 'Pesawat terbang', kategori: 'transportasi', level: 'n5' },
            { id: 'denwa', kana: 'ã§ã‚“ã‚', kanji: 'é›»è©±', romaji: 'denwa', arti: 'Telepon', kategori: 'benda', level: 'n5' },
            { id: 'okane', kana: 'ãŠã‹ã­', kanji: 'ãŠé‡‘', romaji: 'okane', arti: 'Uang', kategori: 'benda', level: 'n5' },

            // --- N5: Waktu ---
            { id: 'jikan', kana: 'ã˜ã‹ã‚“', kanji: 'æ™‚é–“', romaji: 'jikan', arti: 'Waktu', kategori: 'waktu', level: 'n5' },
            { id: 'kyou', kana: 'ãã‚‡ã†', kanji: 'ä»Šæ—¥', romaji: 'kyou', arti: 'Hari ini', kategori: 'waktu', level: 'n5' },
            { id: 'ashita', kana: 'ã‚ã—ãŸ', kanji: 'æ˜æ—¥', romaji: 'ashita', arti: 'Besok', kategori: 'waktu', level: 'n5' },
            { id: 'kinou', kana: 'ãã®ã†', kanji: 'æ˜¨æ—¥', romaji: 'kinou', arti: 'Kemarin', kategori: 'waktu', level: 'n5' },
            { id: 'asa', kana: 'ã‚ã•', kanji: 'æœ', romaji: 'asa', arti: 'Pagi', kategori: 'waktu', level: 'n5' },
            { id: 'hiru', kana: 'ã²ã‚‹', kanji: 'æ˜¼', romaji: 'hiru', arti: 'Siang', kategori: 'waktu', level: 'n5' },
            { id: 'yoru', kana: 'ã‚ˆã‚‹', kanji: 'å¤œ', romaji: 'yoru', arti: 'Malam', kategori: 'waktu', level: 'n5' },
            { id: 'maiasa', kana: 'ã¾ã„ã‚ã•', kanji: 'æ¯æœ', romaji: 'maiasa', arti: 'Setiap pagi', kategori: 'waktu', level: 'n5' },
            { id: 'mainichi', kana: 'ã¾ã„ã«ã¡', kanji: 'æ¯æ—¥', romaji: 'mainichi', arti: 'Setiap hari', kategori: 'waktu', level: 'n5' },
            { id: 'raishuu', kana: 'ã‚‰ã„ã—ã‚…ã†', kanji: 'æ¥é€±', romaji: 'raishuu', arti: 'Minggu depan', kategori: 'waktu', level: 'n5' },
            { id: 'senshuu', kana: 'ã›ã‚“ã—ã‚…ã†', kanji: 'å…ˆé€±', romaji: 'senshuu', arti: 'Minggu lalu', kategori: 'waktu', level: 'n5' },
            { id: 'ima', kana: 'ã„ã¾', kanji: 'ä»Š', romaji: 'ima', arti: 'Sekarang', kategori: 'waktu', level: 'n5' },
            { id: 'gozen', kana: 'ã”ãœã‚“', kanji: 'åˆå‰', romaji: 'gozen', arti: 'Pagi (AM)', kategori: 'waktu', level: 'n5' },
            { id: 'gogo', kana: 'ã”ã”', kanji: 'åˆå¾Œ', romaji: 'gogo', arti: 'Sore (PM)', kategori: 'waktu', level: 'n5' },

            // --- N5: Hewan ---
            { id: 'neko', kana: 'ã­ã“', kanji: 'çŒ«', romaji: 'neko', arti: 'Kucing', kategori: 'hewan', level: 'n5' },
            { id: 'inu', kana: 'ã„ã¬', kanji: 'çŠ¬', romaji: 'inu', arti: 'Anjing', kategori: 'hewan', level: 'n5' },
            { id: 'tori', kana: 'ã¨ã‚Š', kanji: 'é³¥', romaji: 'tori', arti: 'Burung', kategori: 'hewan', level: 'n5' },

            // --- N5: Cuaca ---
            { id: 'tenki', kana: 'ã¦ã‚“ã', kanji: 'å¤©æ°—', romaji: 'tenki', arti: 'Cuaca', kategori: 'cuaca', level: 'n5' },
            { id: 'hare', kana: 'ã¯ã‚Œ', kanji: 'æ™´ã‚Œ', romaji: 'hare', arti: 'Cerah', kategori: 'cuaca', level: 'n5' },
            { id: 'ame', kana: 'ã‚ã‚', kanji: 'é›¨', romaji: 'ame', arti: 'Hujan', kategori: 'cuaca', level: 'n5' },
            { id: 'yuki', kana: 'ã‚†ã', kanji: 'é›ª', romaji: 'yuki', arti: 'Salju', kategori: 'cuaca', level: 'n5' },
            { id: 'kumori', kana: 'ãã‚‚ã‚Š', kanji: 'æ›‡ã‚Š', romaji: 'kumori', arti: 'Berawan', kategori: 'cuaca', level: 'n5' },

            // --- N5: Warna ---
            { id: 'aka', kana: 'ã‚ã‹', kanji: 'èµ¤', romaji: 'aka', arti: 'Merah', kategori: 'warna', level: 'n5' },
            { id: 'ao', kana: 'ã‚ãŠ', kanji: 'é’', romaji: 'ao', arti: 'Biru', kategori: 'warna', level: 'n5' },
            { id: 'shiro', kana: 'ã—ã‚', kanji: 'ç™½', romaji: 'shiro', arti: 'Putih', kategori: 'warna', level: 'n5' },
            { id: 'kuro', kana: 'ãã‚', kanji: 'é»’', romaji: 'kuro', arti: 'Hitam', kategori: 'warna', level: 'n5' },
            { id: 'kiiro', kana: 'ãã„ã‚', kanji: 'é»„è‰²', romaji: 'kiiro', arti: 'Kuning', kategori: 'warna', level: 'n5' },
            { id: 'midori', kana: 'ã¿ã©ã‚Š', kanji: 'ç·‘', romaji: 'midori', arti: 'Hijau', kategori: 'warna', level: 'n5' },

            // --- N5: Pakaian ---
            { id: 'fuku', kana: 'ãµã', kanji: 'æœ', romaji: 'fuku', arti: 'Pakaian', kategori: 'pakaian', level: 'n5' },
            { id: 'shatsu', kana: 'ã‚·ãƒ£ãƒ„', kanji: '', romaji: 'shatsu', arti: 'Kemeja', kategori: 'pakaian', level: 'n5' },
            { id: 'zubon', kana: 'ã‚ºãƒœãƒ³', kanji: '', romaji: 'zubon', arti: 'Celana', kategori: 'pakaian', level: 'n5' },
            { id: 'sukaato', kana: 'ã‚¹ã‚«ãƒ¼ãƒˆ', kanji: '', romaji: 'sukaato', arti: 'Rok', kategori: 'pakaian', level: 'n5' },
            { id: 'kutsu', kana: 'ãã¤', kanji: 'é´', romaji: 'kutsu', arti: 'Sepatu', kategori: 'pakaian', level: 'n5' },
            { id: 'boushi', kana: 'ã¼ã†ã—', kanji: 'å¸½å­', romaji: 'boushi', arti: 'Topi', kategori: 'pakaian', level: 'n5' },

            // --- N5: Lain-lain (diambil dari daftar lama yg belum masuk) ---
            { id: 'uma', kana: 'ã†ã¾', kanji: 'é¦¬', romaji: 'uma', arti: 'Kuda', kategori: 'hewan', level: 'n5' },
            { id: 'zou', kana: 'ãã†', kanji: 'è±¡', romaji: 'zou', arti: 'Gajah', kategori: 'hewan', level: 'n5' },
            { id: 'doumoarigatou', kana: 'ã©ã†ã‚‚ã‚ã‚ŠãŒã¨ã†', kanji: '', romaji: 'doumo arigatou', arti: 'Terima kasih banyak', kategori: 'salam', level: 'n5' },


            // ===========================================
            // === MULAI KOSAKATA N4 ===
            // ===========================================

            // --- N4: Kata Kerja ---
            { id: 'ageru', kana: 'ã‚ã’ã‚‹', kanji: 'ä¸Šã’ã‚‹', romaji: 'ageru', arti: 'Memberi', kategori: 'kerja', level: 'n4' },
            { id: 'morau', kana: 'ã‚‚ã‚‰ã†', kanji: 'è²°ã†', romaji: 'morau', arti: 'Menerima', kategori: 'kerja', level: 'n4' },
            { id: 'kureru', kana: 'ãã‚Œã‚‹', kanji: 'å‘‰ã‚Œã‚‹', romaji: 'kureru', arti: 'Memberi (kepada saya)', kategori: 'kerja', level: 'n4' },
            { id: 'hajimaru', kana: 'ã¯ã˜ã¾ã‚‹', kanji: 'å§‹ã¾ã‚‹', romaji: 'hajimaru', arti: 'Mulai (intransitif)', kategori: 'kerja', level: 'n4' },
            { id: 'owaru', kana: 'ãŠã‚ã‚‹', kanji: 'çµ‚ã‚ã‚‹', romaji: 'owaru', arti: 'Selesai', kategori: 'kerja', level: 'n4' },
            { id: 'nugu', kana: 'ã¬ã', kanji: 'è„±ã', romaji: 'nugu', arti: 'Melepas (pakaian/sepatu)', kategori: 'kerja', level: 'n4' },
            { id: 'kiru_wear', kana: 'ãã‚‹', kanji: 'ç€ã‚‹', romaji: 'kiru', arti: 'Memakai (pakaian atas)', kategori: 'kerja', level: 'n4' },
            { id: 'haku', kana: 'ã¯ã', kanji: 'å±¥ã', romaji: 'haku', arti: 'Memakai (pakaian bawah/sepatu)', kategori: 'kerja', level: 'n4' },
            { id: 'wasureru', kana: 'ã‚ã™ã‚Œã‚‹', kanji: 'å¿˜ã‚Œã‚‹', romaji: 'wasureru', arti: 'Lupa', kategori: 'kerja', level: 'n4' },
            { id: 'oboeru', kana: 'ãŠã¼ãˆã‚‹', kanji: 'è¦šãˆã‚‹', romaji: 'oboeru', arti: 'Mengingat', kategori: 'kerja', level: 'n4' },
            { id: 'shiraberu', kana: 'ã—ã‚‰ã¹ã‚‹', kanji: 'èª¿ã¹ã‚‹', romaji: 'shiraberu', arti: 'Mencari tahu / Memeriksa', kategori: 'kerja', level: 'n4' },
            { id: 'suteru', kana: 'ã™ã¦ã‚‹', kanji: 'æ¨ã¦ã‚‹', romaji: 'suteru', arti: 'Membuang', kategori: 'kerja', level: 'n4' },
            { id: 'hirowu', kana: 'ã²ã‚ã†', kanji: 'æ‹¾ã†', romaji: 'hirowu', arti: 'Memungut', kategori: 'kerja', level: 'n4' },
            { id: 'matsu', kana: 'ã¾ã¤', kanji: 'å¾…ã¤', romaji: 'matsu', arti: 'Menunggu', kategori: 'kerja', level: 'n4' },
            { id: 'yobu', kana: 'ã‚ˆã¶', kanji: 'å‘¼ã¶', romaji: 'yobu', arti: 'Memanggil', kategori: 'kerja', level: 'n4' },
            { id: 'dekiru', kana: 'ã§ãã‚‹', kanji: 'å‡ºæ¥ã‚‹', romaji: 'dekiru', arti: 'Bisa / Dapat', kategori: 'kerja', level: 'n4' },
            { id: 'asobu', kana: 'ã‚ãã¶', kanji: 'éŠã¶', romaji: 'asobu', arti: 'Bermain', kategori: 'kerja', level: 'n4' },
            { id: 'aruku', kana: 'ã‚ã‚‹ã', kanji: 'æ­©ã', romaji: 'aruku', arti: 'Berjalan', kategori: 'kerja', level: 'n4' },
            { id: 'hashiru', kana: 'ã¯ã—ã‚‹', kanji: 'èµ°ã‚‹', romaji: 'hashiru', arti: 'Berlari', kategori: 'kerja', level: 'n4' },
            { id: 'tsukuru', kana: 'ã¤ãã‚‹', kanji: 'ä½œã‚‹', romaji: 'tsukuru', arti: 'Membuat', kategori: 'kerja', level: 'n4' },
            { id: 'naosu', kana: 'ãªãŠã™', kanji: 'ç›´ã™', romaji: 'naosu', arti: 'Memperbaiki', kategori: 'kerja', level: 'n4' },
            { id: 'shinu', kana: 'ã—ã¬', kanji: 'æ­»ã¬', romaji: 'shinu', arti: 'Mati', kategori: 'kerja', level: 'n4' },

            // --- N4: Kata Sifat (i-keiyoushi) ---
            { id: 'atsui_thick', kana: 'ã‚ã¤ã„', kanji: 'åšã„', romaji: 'atsui', arti: 'Tebal', kategori: 'sifat-i', level: 'n4' },
            { id: 'usui', kana: 'ã†ã™ã„', kanji: 'è–„ã„', romaji: 'usui', arti: 'Tipis', kategori: 'sifat-i', level: 'n4' },
            { id: 'hidoi', kana: 'ã²ã©ã„', kanji: 'é…·ã„', romaji: 'hidoi', arti: 'Parah / Kejam', kategori: 'sifat-i', level: 'n4' },
            { id: 'sugoi', kana: 'ã™ã”ã„', kanji: 'å‡„ã„', romaji: 'sugoi', arti: 'Hebat / Luar biasa', kategori: 'sifat-i', level: 'n4' },
            { id: 'wakai', kana: 'ã‚ã‹ã„', kanji: 'è‹¥ã„', romaji: 'wakai', arti: 'Muda', kategori: 'sifat-i', level: 'n4' },
            { id: 'nemui', kana: 'ã­ã‚€ã„', kanji: 'çœ ã„', romaji: 'nemui', arti: 'Mengantuk', kategori: 'sifat-i', level: 'n4' },
            { id: 'itai', kana: 'ã„ãŸã„', kanji: 'ç—›ã„', romaji: 'itai', arti: 'Sakit', kategori: 'sifat-i', level: 'n4' },

            // --- N4: Kata Sifat (na-keiyoushi) ---
            { id: 'shinsetsu', kana: 'ã—ã‚“ã›ã¤', kanji: 'è¦ªåˆ‡', romaji: 'shinsetsu', arti: 'Ramah / Baik hati', kategori: 'sifat-na', level: 'n4' },
            { id: 'anzen', kana: 'ã‚ã‚“ãœã‚“', kanji: 'å®‰å…¨', romaji: 'anzen', arti: 'Aman', kategori: 'sifat-na', level: 'n4' },
            { id: 'kiken', kana: 'ãã‘ã‚“', kanji: 'å±é™º', romaji: 'kiken', arti: 'Berbahaya', kategori: 'sifat-na', level: 'n4' },
            { id: 'taisetsu', kana: 'ãŸã„ã›ã¤', kanji: 'å¤§åˆ‡', romaji: 'taisetsu', arti: 'Penting', kategori: 'sifat-na', level: 'n4' },
            { id: 'daiji', kana: 'ã ã„ã˜', kanji: 'å¤§äº‹', romaji: 'daiji', arti: 'Penting / Berharga', kategori: 'sifat-na', level: 'n4' },
            { id: 'teinei', kana: 'ã¦ã„ã­ã„', kanji: 'ä¸å¯§', romaji: 'teinei', arti: 'Sopan', kategori: 'sifat-na', level: 'n4' },
            { id: 'jiyuu', kana: 'ã˜ã‚†ã†', kanji: 'è‡ªç”±', romaji: 'jiyuu', arti: 'Bebas', kategori: 'sifat-na', level: 'n4' },
            { id: 'muri', kana: 'ã‚€ã‚Š', kanji: 'ç„¡ç†', romaji: 'muri', arti: 'Tidak mungkin / Memaksa diri', kategori: 'sifat-na', level: 'n4' },

            // --- N4: Kata Benda ---
            { id: 'jisho', kana: 'ã˜ã—ã‚‡', kanji: 'è¾æ›¸', romaji: 'jisho', arti: 'Kamus', kategori: 'benda', level: 'n4' },
            { id: 'chizu', kana: 'ã¡ãš', kanji: 'åœ°å›³', romaji: 'chizu', arti: 'Peta', kategori: 'benda', level: 'n4' },
            { id: 'mado', kana: 'ã¾ã©', kanji: 'çª“', romaji: 'mado', arti: 'Jendela', kategori: 'benda', level: 'n4' },
            { id: 'doa', kana: 'ãƒ‰ã‚¢', kanji: '', romaji: 'doa', arti: 'Pintu', kategori: 'benda', level: 'n4' },
            { id: 'nimotsu', kana: 'ã«ã‚‚ã¤', kanji: 'è·ç‰©', romaji: 'nimotsu', arti: 'Barang bawaan', kategori: 'benda', level: 'n4' },
            { id: 'genkan', kana: 'ã’ã‚“ã‹ã‚“', kanji: 'ç„é–¢', romaji: 'genkan', arti: 'Area pintu masuk rumah', kategori: 'tempat', level: 'n4' },
            { id: 'daidokoro', kana: 'ã ã„ã©ã“ã‚', kanji: 'å°æ‰€', romaji: 'daidokoro', arti: 'Dapur', kategori: 'tempat', level: 'n4' },
            { id: 'shorui', kana: 'ã—ã‚‡ã‚‹ã„', kanji: 'æ›¸é¡', romaji: 'shorui', arti: 'Dokumen', kategori: 'benda', level: 'n4' },
            { id: 'kagi', kana: 'ã‹ã', kanji: 'éµ', romaji: 'kagi', arti: 'Kunci', kategori: 'benda', level: 'n4' },
            { id: 'riyuu', kana: 'ã‚Šã‚†ã†', kanji: 'ç†ç”±', romaji: 'riyuu', arti: 'Alasan', kategori: 'dasar', level: 'n4' },
            { id: 'mondai', kana: 'ã‚‚ã‚“ã ã„', kanji: 'å•é¡Œ', romaji: 'mondai', arti: 'Masalah / Soal', kategori: 'dasar', level: 'n4' },
            { id: 'kotae', kana: 'ã“ãŸãˆ', kanji: 'ç­”ãˆ', romaji: 'kotae', arti: 'Jawaban', kategori: 'dasar', level: 'n4' },
            { id: 'shumi', kana: 'ã—ã‚…ã¿', kanji: 'è¶£å‘³', romaji: 'shumi', arti: 'Hobi', kategori: 'dasar', level: 'n4' },

            // --- N4: Tempat ---
            { id: 'kyoukai', kana: 'ãã‚‡ã†ã‹ã„', kanji: 'æ•™ä¼š', romaji: 'kyoukai', arti: 'Gereja', kategori: 'tempat', level: 'n4' },
            { id: 'taishikan', kana: 'ãŸã„ã—ã‹ã‚“', kanji: 'å¤§ä½¿é¤¨', romaji: 'taishikan', arti: 'Kedutaan besar', kategori: 'tempat', level: 'n4' },
            { id: 'kawa', kana: 'ã‹ã‚', kanji: 'å·', romaji: 'kawa', arti: 'Sungai', kategori: 'tempat', level: 'n4' },
            { id: 'yama', kana: 'ã‚„ã¾', kanji: 'å±±', romaji: 'yama', arti: 'Gunung', kategori: 'tempat', level: 'n4' },
            { id: 'onsen', kana: 'ãŠã‚“ã›ã‚“', kanji: 'æ¸©æ³‰', romaji: 'onsen', arti: 'Pemandian air panas', kategori: 'tempat', level: 'n4' },
            { id: 'koujou', kana: 'ã“ã†ã˜ã‚‡ã†', kanji: 'å·¥å ´', romaji: 'koujou', arti: 'Pabrik', kategori: 'tempat', level: 'n4' },

            // --- N4: Waktu & Keterangan ---
            { id: 'saikin', kana: 'ã•ã„ãã‚“', kanji: 'æœ€è¿‘', romaji: 'saikin', arti: 'Akhir-akhir ini', kategori: 'waktu', level: 'n4' },
            { id: 'suguni', kana: 'ã™ãã«', kanji: '', romaji: 'suguni', arti: 'Segera', kategori: 'keterangan', level: 'n4' },
            { id: 'yukkuri', kana: 'ã‚†ã£ãã‚Š', kanji: '', romaji: 'yukkuri', arti: 'Perlahan-lahan', kategori: 'keterangan', level: 'n4' },
            { id: 'mou sugu', kana: 'ã‚‚ã†ã™ã', kanji: '', romaji: 'mou sugu', arti: 'Segera / Sebentar lagi', kategori: 'waktu', level: 'n4' },
            { id: 'tabun', kana: 'ãŸã¶ã‚“', kanji: 'å¤šåˆ†', romaji: 'tabun', arti: 'Mungkin', kategori: 'keterangan', level: 'n4' },
            { id: 'kitto', kana: 'ãã£ã¨', kanji: '', romaji: 'kitto', arti: 'Pasti', kategori: 'keterangan', level: 'n4' },
            { id: 'moshi', kana: 'ã‚‚ã—', kanji: '', romaji: 'moshi', arti: 'Jika / Seandainya', kategori: 'keterangan', level: 'n4' },
            { id: 'ikura', kana: 'ã„ãã‚‰', kanji: '', romaji: 'ikura', arti: 'Berapa (harga)', kategori: 'keterangan', level: 'n4' },
            { id: 'daitai', kana: 'ã ã„ãŸã„', kanji: 'å¤§ä½“', romaji: 'daitai', arti: 'Kira-kira / Pada umumnya', kategori: 'keterangan', level: 'n4' },
            { id: 'chanto', kana: 'ã¡ã‚ƒã‚“ã¨', kanji: '', romaji: 'chanto', arti: 'Dengan benar / Dengan baik', kategori: 'keterangan', level: 'n4' },

            // ===========================================
            // === BARU: KOSAKATA KERJA / KEIGO (N4) ===
            // ===========================================
            { id: 'otsukaresama', kana: 'ãŠã¤ã‹ã‚Œã•ã¾', kanji: 'ãŠç–²ã‚Œæ§˜', romaji: 'otsukaresama', arti: 'Terima kasih atas kerja kerasnya (sapaan di kantor)', kategori: 'keigo', level: 'n4' },
            { id: 'osakini', kana: 'ãŠã•ãã«', kanji: 'ãŠå…ˆã«', romaji: 'osaki ni shitsurei shimasu', arti: 'Permisi duluan (saat pulang kerja)', kategori: 'keigo', level: 'n4' },
            { id: 'kashikomarimashita', kana: 'ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸ', kanji: '', romaji: 'kashikomarimashita', arti: 'Baik, saya mengerti (sangat sopan)', kategori: 'keigo', level: 'n4' },
            { id: 'shouchi', kana: 'ã—ã‚‡ã†ã¡', kanji: 'æ‰¿çŸ¥', romaji: 'shouchi itashimashita', arti: 'Baik, saya pahami (sangat sopan)', kategori: 'keigo', level: 'n4' },
            { id: 'moushiwake', kana: 'ã‚‚ã†ã—ã‚ã‘', kanji: 'ç”³ã—è¨³', romaji: 'moushiwake gozaimasen', arti: 'Mohon maaf (sangat formal)', kategori: 'keigo', level: 'n4' },
            { id: 'yoroshii', kana: 'ã‚ˆã‚ã—ã„', kanji: 'å®œã—ã„', romaji: 'yoroshii desu ka', arti: 'Apakah boleh? / Apakah Anda ada waktu?', kategori: 'keigo', level: 'n4' },
            { id: 'kaigi', kana: 'ã‹ã„ã', kanji: 'ä¼šè­°', romaji: 'kaigi', arti: 'Rapat / Meeting', kategori: 'keigo', level: 'n4' },
            { id: 'shiryou', kana: 'ã—ã‚Šã‚‡ã†', kanji: 'è³‡æ–™', romaji: 'shiryou', arti: 'Dokumen / Materi', kategori: 'keigo', level: 'n4' },
            { id: 'meishi', kana: 'ã‚ã„ã—', kanji: 'ååˆº', romaji: 'meishi', arti: 'Kartu nama', kategori: 'keigo', level: 'n4' },
            { id: 'zangyou', kana: 'ã–ã‚“ãã‚‡ã†', kanji: 'æ®‹æ¥­', romaji: 'zangyou', arti: 'Lembur', kategori: 'keigo', level: 'n4' },
            { id: 'kyuukei', kana: 'ãã‚…ã†ã‘ã„', kanji: 'ä¼‘æ†©', romaji: 'kyuukei', arti: 'Istirahat', kategori: 'keigo', level: 'n4' },
            { id: 'shachou', kana: 'ã—ã‚ƒã¡ã‚‡ã†', kanji: 'ç¤¾é•·', romaji: 'shachou', arti: 'Presiden Direktur', kategori: 'keigo', level: 'n4' },
            { id: 'buchou', kana: 'ã¶ã¡ã‚‡ã†', kanji: 'éƒ¨é•·', romaji: 'buchou', arti: 'Kepala Departemen', kategori: 'keigo', level: 'n4' },
            { id: 'denwa_deru', kana: 'ã§ã‚“ã‚ã«ã§ã‚‹', kanji: 'é›»è©±ã«å‡ºã‚‹', romaji: 'denwa ni deru', arti: 'Menjawab telepon', kategori: 'keigo', level: 'n4' },
            { id: 'renraku', kana: 'ã‚Œã‚“ã‚‰ã', kanji: 'é€£çµ¡', romaji: 'renraku suru', arti: 'Menghubungi / Mengontak', kategori: 'keigo', level: 'n4' },
        ];


        // STATE (untuk favorit dan SRS)
        const VOCAB_KEY = 'kanaTrainer_vocab_v1';
        let state = loadVocabState();

        function loadVocabState() {
            try {
                const raw = localStorage.getItem(VOCAB_KEY);
                const loadedState = raw ? JSON.parse(raw) : {};
                // Initialize fav as a Set for easier lookup
                loadedState.fav = new Set(loadedState.fav || []);
                // Initialize srs as an object
                loadedState.srs = loadedState.srs || {};
                return loadedState;
            } catch (e) {
                console.error("Error loading vocab state from localStorage:", e);
                return { fav: new Set(), srs: {} };
            }
        }

        function saveVocabState() {
            try {
                const stateToSave = {
                    ...state,
                    fav: Array.from(state.fav) // Convert Set back to Array for storage
                };
                localStorage.setItem(VOCAB_KEY, JSON.stringify(stateToSave));
            } catch (e) {
                console.error("Error saving vocab state to localStorage:", e);
            }
        }

        // SRS Intervals (in seconds) - Re-defined here for index4.html
        const SRS_INTERVAL = {
            1: 0,      // Box 1: Immediate repeat
            2: 86400,  // Box 2: 1 day
            3: 3 * 86400, // Box 3: 3 days
            4: 7 * 86400, // Box 4: 7 days
            5: 14 * 86400 // Box 5: 14 days
        };

        // Function to mark SRS progress
        window.srsMark = function (vocabId, isCorrect) {
            const now = Math.floor(Date.now() / 1000);
            const currentBox = state.srs[vocabId] ? state.srs[vocabId].box : 1;
            let nextBox = currentBox;

            if (isCorrect) {
                nextBox = Math.min(5, currentBox + 1);
            } else {
                nextBox = 1; // Reset to box 1 on incorrect answer
            }

            state.srs[vocabId] = {
                box: nextBox,
                due: now + SRS_INTERVAL[nextBox]
            };
            saveVocabState();
        };

        window.dueToday = function () {
            const now = Math.floor(Date.now() / 1000);
            return vocabulary.filter(item => {
                const srsData = state.srs[item.id];
                return srsData && srsData.due <= now;
            });
        };


        // Elemen DOM
        const searchInput = document.getElementById('searchInput');
        const levelChips = document.getElementById('levelChips'); // Elemen baru
        const categoryChips = document.getElementById('categoryChips');
        const vocabList = document.getElementById('vocabList');

        // State Filter Baru
        let activeLevel = 'semua';
        let activeCategory = 'semua';
        let currentFilteredVocab = []; // Global variable for filtered vocab

        // Fungsi baru untuk render level
        function renderLevelChips() {
            const levels = ['semua', 'n5', 'n4'];
            levelChips.innerHTML = '';
            levels.forEach(level => {
                const chip = document.createElement('button');
                chip.className = 'chip';
                // Capitalize
                let text = level.charAt(0).toUpperCase() + level.slice(1);
                if (level === 'semua') text = 'Semua Level';

                chip.textContent = text;
                chip.dataset.level = level;
                if (level === activeLevel) {
                    chip.classList.add('active');
                }
                chip.addEventListener('click', () => {
                    activeLevel = level;
                    activeCategory = 'semua'; // Reset kategori saat ganti level
                    renderLevelChips();  // Render ulang level
                    renderCategories();  // Render ulang kategori berdasarkan level
                    renderVocabList(); // Render ulang daftar kosakata
                });
                levelChips.appendChild(chip);
            });
        }

        function renderCategories() {
            // 1. Filter vocab berdasarkan level yang aktif
            const vocabByLevel = vocabulary.filter(item => {
                return activeLevel === 'semua' || item.level === activeLevel;
            });

            // 2. Dapatkan kategori unik dari vocab yang sudah difilter
            const categories = ['semua', ...new Set(vocabByLevel.map(item => item.kategori))].sort();

            categoryChips.innerHTML = '';

            // Jangan tampilkan filter kategori jika level 'semua' dan kategori hanya 'semua' (tidak ada data)
            if (categories.length <= 1) {
                categoryChips.innerHTML = '<div class="small">Tidak ada kategori untuk level ini.</div>';
                return;
            }

            categories.forEach(category => {
                const chip = document.createElement('button');
                chip.className = 'chip';
                // Capitalize first letter for display
                chip.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                chip.dataset.category = category;
                if (category === activeCategory) {
                    chip.classList.add('active');
                }
                chip.addEventListener('click', () => {
                    activeCategory = category;
                    renderCategories(); // Render ulang untuk memperbarui status aktif
                    renderVocabList(); // Render ulang daftar kosakata
                });
                categoryChips.appendChild(chip);
            });
        }

        function renderVocabList() {
            const searchTerm = searchInput.value.toLowerCase();

            currentFilteredVocab = vocabulary.filter(item => {
                // Filter berdasarkan Level
                const inLevel = activeLevel === 'semua' || item.level === activeLevel;
                // Filter berdasarkan Kategori
                const inCategory = activeCategory === 'semua' || item.kategori === activeCategory;

                // Filter berdasarkan Search
                const matchesSearch = item.kana.includes(searchTerm) ||
                    item.romaji.includes(searchTerm) ||
                    item.arti.toLowerCase().includes(searchTerm) ||
                    (item.kanji && item.kanji.includes(searchTerm));

                return inLevel && inCategory && matchesSearch;
            });

            vocabList.innerHTML = ''; // Kosongkan daftar saat ini
            if (currentFilteredVocab.length === 0) {
                vocabList.innerHTML = '<li class="vocab-item"><div class="arti">Tidak ada hasil ditemukan.</div></li>';
                return;
            }

            currentFilteredVocab.forEach(item => {
                const li = document.createElement('li');
                li.className = 'vocab-item';
                li.innerHTML = `
                    <div class="vocab-jp">
                        <span class="kanji">${item.kanji || item.kana}</span>
                        ${item.kanji && item.kanji !== item.kana ? `<span class="kana">${item.kana}</span>` : ''}
                    </div>
                    <div class="vocab-id">
                        <span class="arti">${item.arti}</span>
                        <span class="romaji">${item.romaji}</span>
                    </div>
                    <i class="fa-solid fa-volume-up"></i>
                `;
                li.addEventListener('click', () => speak(item.kanji || item.kana)); // Ucapkan kanji jika tersedia, jika tidak kana
                vocabList.appendChild(li);
            });
            window.currentFilteredVocab = currentFilteredVocab; // Make it globally accessible for the quiz
        }

        function speak(text) {
            try {
                if (!('speechSynthesis' in window)) {
                    // Gunakan kotak pesan kustom sebagai ganti alert
                    displayMessageBox('Maaf, browser Anda tidak mendukung fitur audio.');
                    return;
                }
                speechSynthesis.cancel(); // Hentikan ucapan yang sedang berlangsung
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ja-JP'; // Atur bahasa ke Jepang
                utterance.rate = 0.9; // Sesuaikan kecepatan ucapan sedikit
                speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('Error speaking text:', error);
            }
        }

        // Fungsi kotak pesan kustom (menggantikan alert)
        function displayMessageBox(message) {
            // Hapus dulu jika ada message box lama
            const oldBox = document.getElementById('customMessageBox');
            if (oldBox) oldBox.remove();

            const messageBox = document.createElement('div');
            messageBox.id = 'customMessageBox'; // Beri ID agar mudah dihapus
            messageBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: var(--panel);
                color: var(--ink);
                padding: 20px;
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                border: 1px solid var(--border);
                z-index: 1000;
                text-align: center;
                max-width: 300px;
                line-height: 1.5;
            `;
            messageBox.innerHTML = `
                <p>${message}</p>
                <button class="btn primary" onclick="this.parentNode.remove()">OK</button>
            `;
            document.body.appendChild(messageBox);
        }

        // Event Listeners
        searchInput.addEventListener('input', renderVocabList);

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', () => {
            renderLevelChips();  // Panggil render level dulu
            renderCategories();  // Baru render kategori
            renderVocabList();   // Terakhir render list
        });

        // Logika pengalih tema (dari index.html asli, ditambahkan untuk kelengkapan)
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'pastel' ? 'hc' : 'pastel';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });

            // Atur tema awal berdasarkan localStorage atau default
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        }

        // --- SIDEBAR JS ---
        (() => {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.getElementById('sidebarToggle');
            const closeBtn = document.getElementById('closeSidebar');

            function open() { sidebar.classList.add('is-open'); document.body.classList.add('sidebar-open'); }
            function close() { sidebar.classList.remove('is-open'); document.body.classList.remove('sidebar-open'); }

            toggle?.addEventListener('click', open);
            closeBtn?.addEventListener('click', close);

            // Klik luar = tutup (mobile)
            document.addEventListener('click', (e) => {
                if (!sidebar.classList.contains('is-open')) return;
                const hit = sidebar.contains(e.target) || toggle.contains(e.target);
                if (!hit) close();
            });
            // ESC = tutup
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });

            // Tandai link aktif sesuai pathname
            document.querySelectorAll('#sidebar a').forEach(a => {
                const href = a.getAttribute('href');
                // Use endsWith for robustness with different base paths
                if (href && location.pathname.endsWith(href)) {
                    a.classList.add('active');
                } else {
                    a.classList.remove('active'); // Ensure other links are not active
                }
            });
        })();

        // --- UJIAN / FLASHCARD â€œKETIK JAWABANâ€ (KHUSUS index4.html) ---
        (() => {
            const fcMode = document.getElementById('fcMode');
            const fcSource = document.getElementById('fcSource');
            const fcStart = document.getElementById('fcStart');
            const fcArea = document.getElementById('fcArea');
            const fcPrompt = document.getElementById('fcPrompt');
            const fcInput = document.getElementById('fcInput');
            const fcCheck = document.getElementById('fcCheck');
            const fcReveal = document.getElementById('fcReveal');
            const fcNext = document.getElementById('fcNext');
            const fcProg = document.getElementById('fcProgress');
            const fcFeed = document.getElementById('fcFeedback');

            // --- Gemini API Configuration ---
            // Dibiarkan kosong, Canvas akan menyediakannya saat runtime.
            // --- Gemini API Configuration ---
            let GEMINI_API_KEY = localStorage.getItem('user_gemini_api_key') || "";

            function getGeminiApiUrl() {
                // Validasi format key (harus berawalan "AIza")
                if (GEMINI_API_KEY && !GEMINI_API_KEY.startsWith('AIza')) {
                    console.warn("API Key invalid (missing 'AIza' prefix). Resetting.");
                    GEMINI_API_KEY = ""; // Reset agar meminta input ulang
                }

                if (!GEMINI_API_KEY) {
                    const input = prompt("Fitur ini membutuhkan Google Gemini API Key. Masukkan Key Anda (akan disimpan di browser):");
                    if (input && input.trim()) {
                        GEMINI_API_KEY = input.trim();
                        localStorage.setItem('user_gemini_api_key', GEMINI_API_KEY);
                    } else {
                        throw new Error("API Key diperlukan untuk menggunakan fitur AI.");
                    }
                }
                return `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;
            }

            // Ambil list sesuai pilihan sumber
            function getPool() {
                // Gunakan currentFilteredVocab yang sudah ter-update
                let list = (window.currentFilteredVocab && currentFilteredVocab.length) ? currentFilteredVocab.slice() : (vocabulary || []);

                // Jika sumbernya "fav", filter ulang berdasarkan favorit
                if (fcSource.value === 'fav' && state?.fav) {
                    list = vocabulary.filter(v => state.fav.has(v.id));
                }

                // Jika sumbernya "rand20", acak dari semua vocab (bukan hanya yg terfilter)
                if (fcSource.value === 'rand20') {
                    list = shuffle(vocabulary.slice()).slice(0, 20);
                }

                // Jika sumbernya "filter", kita gunakan list yg sudah difilter di awal
                // (tidak perlu melakukan apa-apa lagi)

                return list;
            }

            function norm(s) { return (s || '').toString().trim().toLowerCase().replace(/\s+/g, ' ').replace(/[ï¼â€“â€”]/g, '-'); }

            function buildQA(item) {
                const conf = {
                    'jp_idn': { q: item.kanji || item.kana, accept: [item.arti] },
                    'jp_ro': { q: item.kanji || item.kana, accept: [item.romaji] },
                    'idn_jp': { q: item.arti, accept: [item.kanji || item.kana] },
                    'ro_jp': { q: item.romaji, accept: [item.kanji || item.kana] },
                    'ai_gen_jp_idn': { q: item.kana, accept: [item.arti] } // For AI generated questions
                }[fcMode.value];

                // Tambahkan kana sebagai jawaban alternatif jika ada kanji
                if (fcMode.value === 'idn_jp' || fcMode.value === 'ro_jp') {
                    if (item.kanji && item.kana && item.kanji !== item.kana) {
                        conf.accept.push(item.kana);
                    }
                }
                // Tambahkan romaji sebagai jawaban alternatif jika targetnya adalah JP
                if (fcMode.value === 'idn_jp' || fcMode.value === 'ro_jp') {
                    conf.accept.push(item.romaji);
                }

                return { q: conf.q, a: conf.accept };
            }

            let deck = []; let idx = 0; let correct = 0;

            function updateProg() { fcProg.textContent = `${Math.min(idx + 1, deck.length)} / ${deck.length}`; }

            async function showCard() {
                const it = deck[idx];
                if (!it) { finish(); return; }

                if (fcSource.value === 'ai_gen') { // Check fcSource value
                    fcPrompt.innerHTML = '<div class="spinner"></div><span>Membuat soal AI...</span>';
                    fcInput.value = ''; fcInput.disabled = true;
                    fcCheck.disabled = true; fcReveal.disabled = true; fcNext.disabled = true;
                    fcFeed.textContent = '';

                    try {
                        // Gunakan level dan kategori yang aktif untuk prompt AI
                        let categoryPrompt = activeCategory === 'semua' ? 'acak' : activeCategory;
                        let levelPrompt = activeLevel === 'semua' ? 'N5 atau N4' : activeLevel;

                        const generatedQuestion = await generateQuestionWithAI(categoryPrompt, levelPrompt);

                        deck[idx] = { // Update current item with AI-generated data
                            id: generatedQuestion.id,
                            kana: generatedQuestion.kana,
                            kanji: generatedQuestion.kanji,
                            romaji: generatedQuestion.romaji,
                            arti: generatedQuestion.arti,
                            kategori: generatedQuestion.kategori
                        };
                        const qa = buildQA(deck[idx]);
                        fcPrompt.textContent = qa.q;
                        fcInput.disabled = false;
                        fcCheck.disabled = false; fcReveal.disabled = false;
                        fcInput.focus();
                    } catch (error) {
                        console.error("Error generating AI question:", error);
                        fcPrompt.textContent = 'Gagal membuat soal AI. Coba lagi.';
                        fcInput.disabled = false;
                        fcCheck.disabled = false; fcReveal.disabled = false;
                    }
                } else {
                    const qa = buildQA(it);
                    fcPrompt.textContent = qa.q;
                    fcInput.value = ''; fcInput.focus();
                    fcFeed.textContent = ''; fcFeed.className = 'small center';
                    fcNext.disabled = true;
                    fcCheck.disabled = false; // Pastikan tombol cek aktif
                    fcReveal.disabled = false; // Pastikan tombol lihat jawaban aktif
                }
                updateProg();
            }

            function check() {
                const it = deck[idx]; if (!it) return;
                const qa = buildQA(it);
                const answer = norm(fcInput.value);
                const ok = qa.a.some(x => norm(x) === answer); // Cek jawaban

                if (ok) {
                    correct++;
                    fcFeed.textContent = 'Benar! âœ…'; fcFeed.className = 'small center ok';
                    try { if (window.srsMark) { srsMark(it.id, true); /* Update SRS */ } } catch (e) { }
                } else {
                    fcFeed.innerHTML = `Salah. Jawaban: <b>${qa.a[0]}</b> âŒ`; fcFeed.className = 'small center bad';
                    try { if (window.srsMark) { srsMark(it.id, false); /* Update SRS */ } } catch (e) { }
                }
                fcNext.disabled = false;
                fcCheck.disabled = true;
                fcReveal.disabled = true;
                fcNext.focus(); // Fokus ke tombol berikutnya
            }

            function reveal() {
                const it = deck[idx]; if (!it) return;
                const qa = buildQA(it);
                fcFeed.innerHTML = `Jawaban: <b>${qa.a[0]}</b>`;
                fcFeed.className = 'small center';
                fcNext.disabled = false;
                fcCheck.disabled = true;
                fcReveal.disabled = true;
                fcNext.focus(); // Fokus ke tombol berikutnya
            }

            function next() {
                idx++;
                if (idx >= deck.length) {
                    finish();
                } else {
                    showCard();
                }
            }

            function finish() {
                fcPrompt.textContent = 'Selesai! ğŸ‰';
                fcInput.value = '';
                fcInput.disabled = true;
                fcFeed.innerHTML = `Skor: <b>${correct}</b> / ${deck.length}`;
                fcNext.disabled = true;
                fcCheck.disabled = true;
                fcReveal.disabled = true;
                fcStart.focus(); // Fokus kembali ke tombol Mulai
            }

            fcStart.addEventListener('click', async () => {
                let pool = [];
                if (fcSource.value === 'ai_gen') {
                    // Buat 10 soal AI
                    pool = Array(10).fill({ id: 'ai_placeholder', kategori: activeCategory });
                } else {
                    pool = getPool();
                }

                if (!pool.length) {
                    fcArea.hidden = false;
                    fcPrompt.textContent = 'Kosong. Atur filter atau tambahkan favorit dulu ya ğŸ™';
                    fcFeed.textContent = '';
                    fcInput.disabled = true;
                    return;
                }

                deck = shuffle(pool).slice(0, Math.min(30, pool.length)); // Batasi maks 30 soal
                idx = 0; correct = 0;
                fcArea.hidden = false;
                fcInput.disabled = false;
                showCard();
            });

            fcCheck.addEventListener('click', check);
            fcReveal.addEventListener('click', reveal);
            fcNext.addEventListener('click', next);

            fcInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (!fcCheck.disabled) check(); // Hanya cek jika tombol aktif
                }
                // Ganti Tab dengan Enter untuk pindah ke soal berikutnya
                if (e.key === 'Enter' && fcCheck.disabled) {
                    e.preventDefault();
                    if (!fcNext.disabled) next(); // Pindah jika tombol Next aktif
                }
            });

            function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[a[i], a[j]] = [a[j], a[i]]; } return a; }

            // --- Gemini API Call Function ---
            async function generateQuestionWithAI(category, level, retries = 0) {
                // Prompt diperbarui untuk meminta level dan kategori
                const prompt = `Generate a Japanese vocabulary word for level ${level}, related to the category "${category}", its romaji, kanji (if applicable, otherwise use kana), and Indonesian meaning. Provide the output in JSON format, like this: {"id": "unique_id", "kana": "kana_form", "kanji": "kanji_form", "romaji": "romaji_form", "arti": "indonesian_meaning", "kategori": "category_name"}. Ensure the word is not already in the N5 list.`;

                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "id": { "type": "STRING" },
                                "kana": { "type": "STRING" },
                                "kanji": { "type": "STRING" },
                                "romaji": { "type": "STRING" },
                                "arti": { "type": "STRING" },
                                "kategori": { "type": "STRING" }
                            },
                            "propertyOrdering": ["id", "kana", "kanji", "romaji", "arti", "kategori"]
                        }
                    }
                };

                try {
                    const response = await fetch(getGeminiApiUrl(), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('Gemini API Error:', errorData);
                        if (response.status === 429 && retries < 5) { // Too Many Requests
                            const delay = Math.pow(2, retries) * 1000 + Math.random() * 1000; // Exponential backoff + jitter
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return generateQuestionWithAI(category, level, retries + 1);
                        }
                        throw new Error(errorData.error?.message || 'Terjadi kesalahan saat menghubungi API.');
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const jsonText = result.candidates[0].content.parts[0].text;
                        const parsedJson = JSON.parse(jsonText);
                        // Ensure 'id' is unique, or generate one if missing/duplicate
                        if (!parsedJson.id || vocabulary.some(v => v.id === parsedJson.id)) {
                            parsedJson.id = `ai_gen_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;
                        }
                        return parsedJson;
                    } else {
                        console.warn("Unexpected API response structure:", result);
                        throw new Error("Failed to parse AI-generated question.");
                    }
                } catch (error) {
                    console.error('Fetch Error:', error);
                    if (retries < 5) { // Retry on network error
                        const delay = Math.pow(2, retries) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return generateQuestionWithAI(category, level, retries + 1);
                    }
                    throw new Error(`Network or API issue: ${error.message}`);
                }
            }


            // --- Update fcMode and fcSource change listeners ---
            fcMode.addEventListener('change', () => {
                // If AI generation mode is selected, force AI_GEN source
                if (fcMode.value === 'ai_gen_jp_idn') {
                    fcSource.value = 'ai_gen';
                    fcSource.disabled = true;
                } else {
                    fcSource.disabled = false;
                }
            });

            fcSource.addEventListener('change', () => {
                // If AI_GEN source is selected, force AI generation mode
                if (fcSource.value === 'ai_gen') {
                    fcMode.value = 'ai_gen_jp_idn';
                    fcMode.disabled = true;
                } else {
                    fcMode.disabled = false;
                }
            });

        })();
    </script>
</body>

</html>